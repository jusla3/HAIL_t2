/*!
 * Name    : Visual Portfolio
 * Version : 1.3.0
 * Author  : nK https://nkdev.info
 */
!function(e){"use strict";function t(){l[c.is(":checked")?"show":"hide"]()}function n(t,n){if(w&&(n=!1,w=!1),vpAdminVariables&&vpAdminVariables.css_editor_error_notice){var i=!1;if(1===t.length?i=vpAdminVariables.css_editor_error_notice.singular.replace("%d","1"):t.length>1&&(i=vpAdminVariables.css_editor_error_notice.plural.replace("%d",String(t.length))),i){var a=C.prev("#vp_custom_css_notice");if(a.length||n||(a=e('<div class="notice notice-error inline" id="vp_custom_css_notice"></div>'),C.before(a)),!a.length)return;var o='<p class="notification-message">'+i+'</p><p><input id="vp_custom_css_notice_prevent" type="checkbox"><label for="vp_custom_css_notice_prevent">'+vpAdminVariables.css_editor_error_checkbox+"</label></p>";a.html(o)}else C.prev("#vp_custom_css_notice").remove()}}var i=e("body"),a=e(window),o=e('form[name="post"]'),r=e('[name="post_type"]'),s=e("#post_ID").val();i.on("focus",'[name="vp_list_shortcode"], [name="vp_filter_shortcode"]',function(){this.select()}),i.on("click",".vp-onclick-selection",function(){window.getSelection().selectAllChildren(this)});var l=e("#vp_format_video"),c=e("#post-format-video");l.length&&c.length&&(t(),i.on("change","[name=post_format]",function(){t()}));var p,v=null;if(i.on("change input",'.vp-input[name="video_url"]',function(){null!==v&&v.abort();var t=e(this);t.next(".vp-oembed-preview").html(""),clearTimeout(p),p=setTimeout(function(){v=e.ajax({url:ajaxurl,method:"GET",dataType:"json",data:{action:"vp_find_oembed",q:t.val(),nonce:vpAdminVariables.nonce},complete:function(e){var n=e.responseJSON;n&&void 0!==n.html&&t.next(".vp-oembed-preview").html(n.html)}})},250)}),"undefined"!=typeof Tooltip&&e('[data-hint]:not([data-hint=""]):not([data-hint="false"])').each(function(){var t=e(this);new Tooltip(this,{placement:t.attr("data-hint-place")||"top",title:t.attr("data-hint")})}),"vp_lists"===r.val()&&o.length){var d=e(".vp-content-source"),u=d.find('[name="vp_content_source"]');d.on("click",".vp-content-source__item",function(){var t=e(this).attr("data-content");d.find('[data-content="'+t+'"]').addClass("active").siblings().removeClass("active"),u.val(t).change()}),d.children('[data-content="'+u.val()+'"]').click(),e.fn.conditionize&&o.conditionize(),e(".vp-control-range").each(function(){var t=e(this).find("input"),n=t.filter('[type="hidden"]');t.on("change input",function(i){t.val(e(this).val()),n.trigger("vp-fake-"+i.type)})}),e.fn.wpColorPicker&&e(".vp-color-picker").each(function(){var t,n=!0;e(this).data("change",function(i,a){n?n=!1:(clearTimeout(t),t=setTimeout(function(){e(i.target).change()},300))}).wpColorPicker()}),e.fn.imagepicker&&e(".vp-image-picker").imagepicker();var m=e(".vp_list_preview iframe"),f=!1,_=!1,g=e('<form target="vp_list_preview_iframe" method="post" style="display: none">').attr("action",m.attr("src")).insertAfter(o);e.fn.iFrameResize&&m.iFrameResize({interval:10});var h;o.on("change input vp-fake-change vp-fake-input",'[name*="vp_"]',function(t){var n=e(this),i={name:n.attr("name"),value:n.is("[type=checkbox], [type=radio]")?n.is(":checked"):n.val(),reload:"change"===t.type||"vp-fake-change"===t.type,jQuery:_,$portfolio:f},o=g.find('[name="'+i.name+'"]');o.length||(o=e('<input type="hidden" name="'+i.name+'" />').appendTo(g)),o.attr("value",i.value),a.trigger("vp-preview-change",i),!i.reload&&f||(clearTimeout(h),h=setTimeout(function(){_=!1,f=!1,g.submit()},400))}),m.on("load",function(){_=this.contentWindow.jQuery,f=_(".vp-portfolio")}),a.on("vp-preview-change",function(e,t){if(t.$portfolio)switch(t.name){case"vp_layout":case"vp_tiles_type":case"vp_masonry_columns":case"vp_items_gap":var n=t.name;n=(n=n.substring(3)).replace("_","-"),t.$portfolio.attr("data-vp-"+n,t.value),t.$portfolio.vp("init"),t.reload=!1;break;case"vp_filter_align":t.$portfolio.find(".vp-filter").removeClass("vp-filter__align-center vp-filter__align-left vp-filter__align-right").addClass("vp-filter__align-"+t.value),t.reload=!1;break;case"vp_pagination_align":t.$portfolio.find(".vp-pagination").removeClass("vp-pagination__align-center vp-pagination__align-left vp-pagination__align-right").addClass("vp-pagination__align-"+t.value),t.reload=!1;break;case"vp_custom_css":var i=t.$portfolio.closest("html"),a="vp-custom-css-"+s+"-inline-css",o=i.find("#"+a);o.length||(o=t.jQuery('<style id="'+a+'">'),i.find("body").prepend(o)),o.html(t.value),t.reload=!1;break;case"vp_list_name":case"vp_stretch":t.reload=!1}}),i.on("click",".vp-control-image-dropdown",function(t){e(t.target).closest(".vp-control-image-dropdown__content").length||e(this).toggleClass("active")}),i.on("mousedown",function(t){var n=e(t.target).closest(".vp-control-image-dropdown");e(".vp-control-image-dropdown.active").each(function(){this!==n[0]&&e(this).removeClass("active")})}),i.on("change",".vp-control-image-dropdown .vp-image-picker",function(t){var n=e(this),i=n.data("picker");if(i){var a=i.select.find('option[value="'+i.select.val()+'"]'),o=a.parent("optgroup"),r=n.closest(".vp-control-image-dropdown"),s=a.attr("data-img-src");r.length&&(r.children(".vp-control-image-dropdown__preview").html('<img src="'+s+'" alt="">'),o.length&&r.children(".vp-control-image-dropdown__title").html(o.attr("label")))}});var y=e('[name="vp_list_name"]'),b=e('[name="post_title"]');y.length&&b.length&&(y.on("input",function(){b.val()!==y.val()&&b.val(y.val()).change()}),b.on("input",function(){y.val(b.val())})),e.fn.select2&&e(".vp-select2").each(function(){var t=e(this),n={width:"100%",minimumResultsForSearch:t.hasClass("vp-select2-nosearch")?-1:1};if(t.closest(".vp-select2-posts-ajax").length){i=!!t.attr("data-post-type")&&e(t.attr("data-post-type"));n=e.extend({minimumInputLength:1,ajax:{url:ajaxurl,dataType:"json",delay:250,data:function(e){return{action:"vp_find_posts",q:e.term,post_type:!!i&&i.val(),nonce:vpAdminVariables.nonce}},processResults:function(e){return{results:!(!e||!e.length)&&e}},cache:!0},escapeMarkup:function(e){return e},templateResult:function(e){if(e.loading)return e.text;var t="";e.title&&(t=e.title);var n="";e.post_type&&(n=e.post_type);var i="";return e.img&&(i="style=\"background-image: url('"+e.img+"');\""),'<div class="vp-select2-ajax__result"><div class="vp-select2-ajax__result-img" '+i+'></div><div class="vp-select2-ajax__result-data"><div class="vp-select2-ajax__result-title">'+t+'</div><div class="vp-select2-ajax__result-post-type">'+n+"</div></div></div>"},templateSelection:function(e){return e.title||e.text}},n)}if(t.closest(".vp-select2-taxonomies-ajax").length){var i=!!t.attr("data-post-type")&&e(t.attr("data-post-type"));n=e.extend({minimumInputLength:1,ajax:{url:ajaxurl,dataType:"json",delay:250,data:function(e){return{action:"vp_find_taxonomies",q:e.term,post_type:!!i&&i.val(),nonce:vpAdminVariables.nonce}},processResults:function(e){var t=[];if(e)for(var n in e)t.push({text:n,children:e[n]});return{results:t}},cache:!0}},n)}t.select2(n).data("select2").$dropdown.addClass("select2-vp-container")});var C=e('[name="vp_custom_css"]'),k=!1,w=!0;if("undefined"!=typeof CodeMirror&&C.length){if(vpAdminVariables&&vpAdminVariables.classnames){var x=CodeMirror.hint.css;CodeMirror.hint.css=function(e){var t=e.getCursor(),n=x(e)||{from:t,to:e.getCursor(),list:[]},i=e.getTokenAt(t);return"top"===i.state.state&&0===i.string.indexOf(".")&&(n={from:CodeMirror.Pos(t.line,i.start),to:CodeMirror.Pos(t.line,i.end),list:[]},vpAdminVariables.classnames.forEach(function(e){-1!==e.indexOf(i.string)&&n.list.push(e)})),n}}var j=CodeMirror.fromTextArea(C[0],{mode:"css",theme:"eclipse",indentUnit:4,autoCloseTags:!0,autoCloseBrackets:!0,matchBrackets:!0,foldGutter:!0,lint:{options:{errors:!0,"box-model":!0,"display-property-grouping":!0,"duplicate-properties":!0,"known-properties":!0,"outline-none":!0},onUpdateLinting:function(e,t,i){var a=[];e.forEach(function(e){"error"===e.severity&&a.push(e)}),i.vcLintErrors=a,k||n(i.vcLintErrors,!0)}},lineNumbers:!0,lineWrapping:!0,scrollPastEnd:!0,emmet_active:!0,emmet:!0,styleActiveLine:!0,continueComments:!0,scrollbarStyle:"simple",extraKeys:{"Ctrl-Space":"autocomplete","Ctrl-/":"toggleComment","Cmd-/":"toggleComment","Alt-F":"findPersistent"},gutters:["CodeMirror-lint-markers","CodeMirror-linenumbers","CodeMirror-foldgutter"]});emmetCodeMirror(j),C.data("CodeMirrorInstance",j),j.on("change",function(){j.save(),C.change()}),j.on("keyup",function(e,t){var n,i,a=/^[a-zA-Z]$/.test(t.key);e.state.completionActive&&a||"string"!==(i=e.getTokenAt(e.getCursor())).type&&"comment"!==i.type&&(n=e.doc.getLine(e.doc.getCursor().line).substr(0,e.doc.getCursor().ch),(a||":"===t.key||" "===t.key&&/:\s+$/.test(n))&&e.showHint({completeSingle:!1}))})}var A=o.serialize();e(window).on("beforeunload",function(){var t=A!==o.serialize(),n=e("[type=submit]").hasClass("disabled");if(t&&!n)return!0}),i.on("click","#publish:not(.disabled)",function(t){if(!k){var i=e(this),a=C.length&&C.data("CodeMirrorInstance");a&&a.vcLintErrors&&a.vcLintErrors.length&&(t.preventDefault(),i.addClass("disabled button-disabled button-primary-disabled"),setTimeout(function(){i.removeClass("disabled button-disabled button-primary-disabled")},1500),n(a.vcLintErrors,!1),e("html,body").animate({scrollTop:e("#vp_custom_css").offset().top-100},300),a.focus(),a.setCursor(a.vcLintErrors[0].from.line))}}),i.on("change","#vp_custom_css_notice_prevent",function(){k=!0,e(this).closest(".notice").slideUp()})}}(jQuery);